# End to end testing on Android

## Current setup

The Android E2E tests rely on a predefined test survey created by the web application and stored in the Firebase emulator data

### 1. Predefined test survey
The test data was originally generated by running the web application locally against the Firebase emulator and exporting the emulator state

### 2. Running the E2E tests
The CI workflow performs the following steps:
1. Start the Firebase emulator using the `start-emulator` action (which loads the predefined data)
2. Run the Android instrumentation tests in the `e2eTest` module against the emulator

## Managing test data

Since the Android app relies on specific survey structures, changes to the survey schema may require updating the test data

1.  Clone `ground-platform` and set up the project (see [documentation](https://github.com/google/ground-platform))
2.  Run the following command to launch the local Firebase emulator with test data:
    ```bash
    nx start-android-test-data
    ```
3.  Manually set up or update the survey (via the web UI) to match the scenarios expected by the Android `e2eTest` module
4.  Verify that all tests pass locally using the `localDebug` build variant
5.  Export the updated emulator data to persist changes:
    ```bash
    firebase emulators:export data/test-android --project demo-local
    ```
    *Note: This overwrites the data in `data/test-android`.*

## Limitations
This setup does not fully prevent data drift between the web and Android apps. Any structural changes in surveys require manual updates to the predefined test data.

This could be improved by implementing web E2E tests that generate Firestore test data on each run and trigger the Android E2E tests. Optionally, the web tests could also verify the final persisted state.